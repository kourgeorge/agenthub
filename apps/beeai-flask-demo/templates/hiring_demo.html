<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent Hiring System - Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .agent-card { transition: transform 0.2s; }
        .agent-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .task-status { font-weight: bold; }
        .status-pending { color: #ffc107; }
        .status-running { color: #17a2b8; }
        .status-completed { color: #28a745; }
        .status-failed { color: #dc3545; }
        .status-cancelled { color: #6c757d; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">ðŸ¤– AI Agent Hiring System - Phase 1 Demo</h1>
        
        <!-- Navigation -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="agents-tab" data-bs-toggle="tab" data-bs-target="#agents" type="button" role="tab">Available Agents</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="hire-tab" data-bs-toggle="tab" data-bs-target="#hire" type="button" role="tab">Hire Agent</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks" type="button" role="tab">My Tasks</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="credits-tab" data-bs-toggle="tab" data-bs-target="#credits" type="button" role="tab">Credits</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabsContent">
            <!-- Available Agents Tab -->
            <div class="tab-pane fade show active" id="agents" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <h3>Available Agents for Hiring</h3>
                        <div id="agentsList" class="row">
                            <div class="col-12">
                                <div class="alert alert-info">Loading agents...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hire Agent Tab -->
            <div class="tab-pane fade" id="hire" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <h3>Hire an Agent</h3>
                        <form id="hireForm">
                            <div class="mb-3">
                                <label for="agentSelect" class="form-label">Select Agent</label>
                                <select class="form-select" id="agentSelect" required>
                                    <option value="">Choose an agent...</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="taskInput" class="form-label">Task Description</label>
                                <textarea class="form-control" id="taskInput" rows="4" placeholder="Describe what you want the agent to do..." required></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Estimated Cost</label>
                                <div id="estimatedCost" class="form-control-plaintext">-</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Hire Agent</button>
                        </form>
                    </div>
                    <div class="col-md-6">
                        <h3>Agent Details</h3>
                        <div id="agentDetails">
                            <div class="alert alert-info">Select an agent to see details</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Tab -->
            <div class="tab-pane fade" id="tasks" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <h3>My Tasks</h3>
                        <div id="tasksList">
                            <div class="alert alert-info">No tasks found</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Credits Tab -->
            <div class="tab-pane fade" id="credits" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <h3>Credits Balance</h3>
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Current Balance</h5>
                                <div id="creditsBalance" class="display-4 text-primary">$0.00</div>
                                <p class="card-text">USD</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h3>Add Credits</h3>
                        <form id="addCreditsForm">
                            <div class="mb-3">
                                <label for="creditAmount" class="form-label">Amount (USD)</label>
                                <input type="number" class="form-control" id="creditAmount" min="1" step="0.01" value="10.00" required>
                            </div>
                            <button type="submit" class="btn btn-success">Add Credits</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'http://localhost:8333/api/v1/hiring';
        let agents = [];
        let tasks = [];

        // Load agents
        async function loadAgents() {
            try {
                const response = await fetch(`${API_BASE}/agents`);
                if (!response.ok) throw new Error('Failed to load agents');
                
                agents = await response.json();
                displayAgents();
                populateAgentSelect();
            } catch (error) {
                console.error('Error loading agents:', error);
                document.getElementById('agentsList').innerHTML = 
                    '<div class="alert alert-danger">Failed to load agents. Make sure the BeeAI server is running.</div>';
            }
        }

        // Display agents
        function displayAgents() {
            const container = document.getElementById('agentsList');
            if (agents.length === 0) {
                container.innerHTML = '<div class="alert alert-warning">No agents available for hiring</div>';
                return;
            }

            container.innerHTML = agents.map(agent => `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card agent-card h-100">
                        <div class="card-body">
                            <h5 class="card-title">${agent.agent_name}</h5>
                            <p class="card-text">${agent.description || 'No description available'}</p>
                            <div class="mb-2">
                                <span class="badge bg-primary">${agent.pricing_model}</span>
                                <span class="badge bg-success">${agent.reliability_score.toFixed(1)}% reliable</span>
                                ${agent.availability ? '<span class="badge bg-success">Available</span>' : '<span class="badge bg-danger">Unavailable</span>'}
                            </div>
                            <div class="mb-2">
                                <strong>Pricing:</strong> 
                                ${agent.pricing_model === 'fixed' ? `$${agent.fixed_price}` : 
                                  agent.pricing_model === 'per_task' ? `$${agent.price_per_task} per task` :
                                  `$${agent.price_per_token} per token`}
                            </div>
                            ${agent.capabilities.length > 0 ? `
                                <div class="mb-2">
                                    <strong>Capabilities:</strong><br>
                                    ${agent.capabilities.map(cap => `<span class="badge bg-secondary me-1">${cap}</span>`).join('')}
                                </div>
                            ` : ''}
                            <button class="btn btn-primary btn-sm" onclick="selectAgent('${agent.agent_name}')">Hire This Agent</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Populate agent select dropdown
        function populateAgentSelect() {
            const select = document.getElementById('agentSelect');
            select.innerHTML = '<option value="">Choose an agent...</option>';
            agents.forEach(agent => {
                const option = document.createElement('option');
                option.value = agent.agent_name;
                option.textContent = agent.agent_name;
                select.appendChild(option);
            });
        }

        // Select agent for hiring
        function selectAgent(agentName) {
            document.getElementById('agentSelect').value = agentName;
            document.getElementById('hire-tab').click();
            updateAgentDetails(agentName);
        }

        // Update agent details
        function updateAgentDetails(agentName) {
            const agent = agents.find(a => a.agent_name === agentName);
            if (!agent) return;

            const details = document.getElementById('agentDetails');
            details.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">${agent.agent_name}</h5>
                        <p class="card-text">${agent.description || 'No description available'}</p>
                        <ul class="list-unstyled">
                            <li><strong>Pricing Model:</strong> ${agent.pricing_model}</li>
                            <li><strong>Reliability Score:</strong> ${agent.reliability_score.toFixed(1)}%</li>
                            <li><strong>Availability:</strong> ${agent.availability ? 'Yes' : 'No'}</li>
                            <li><strong>Currency:</strong> ${agent.currency}</li>
                        </ul>
                        ${agent.capabilities.length > 0 ? `
                            <div>
                                <strong>Capabilities:</strong>
                                <div class="mt-2">
                                    ${agent.capabilities.map(cap => `<span class="badge bg-secondary me-1">${cap}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            // Update estimated cost
            const costDisplay = document.getElementById('estimatedCost');
            if (agent.pricing_model === 'fixed') {
                costDisplay.textContent = `$${agent.fixed_price}`;
            } else if (agent.pricing_model === 'per_task') {
                costDisplay.textContent = `$${agent.price_per_task} per task`;
            } else {
                costDisplay.textContent = `$${agent.price_per_token} per token`;
            }
        }

        // Handle hire form submission
        document.getElementById('hireForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const agentName = document.getElementById('agentSelect').value;
            const taskInput = document.getElementById('taskInput').value;
            
            if (!agentName || !taskInput) {
                alert('Please select an agent and provide a task description');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/agents/${encodeURIComponent(agentName)}/hire`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        task_input: taskInput
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to hire agent');
                }

                const result = await response.json();
                alert(`Agent hired successfully! Task ID: ${result.task_id}`);
                
                // Clear form
                document.getElementById('taskInput').value = '';
                
                // Switch to tasks tab
                document.getElementById('tasks-tab').click();
                
            } catch (error) {
                alert(`Error hiring agent: ${error.message}`);
            }
        });

        // Load credits
        async function loadCredits() {
            try {
                const response = await fetch(`${API_BASE}/credits`);
                if (!response.ok) throw new Error('Failed to load credits');
                
                const credits = await response.json();
                document.getElementById('creditsBalance').textContent = `$${credits.balance}`;
            } catch (error) {
                console.error('Error loading credits:', error);
            }
        }

        // Handle add credits form
        document.getElementById('addCreditsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('creditAmount').value);
            if (amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }

            // For demo purposes, we'll just update the display
            // In a real implementation, this would call the API
            const currentBalance = parseFloat(document.getElementById('creditsBalance').textContent.replace('$', ''));
            const newBalance = currentBalance + amount;
            document.getElementById('creditsBalance').textContent = `$${newBalance.toFixed(2)}`;
            
            alert(`Added $${amount.toFixed(2)} to your account`);
            document.getElementById('creditAmount').value = '10.00';
        });

        // Agent select change handler
        document.getElementById('agentSelect').addEventListener('change', (e) => {
            if (e.target.value) {
                updateAgentDetails(e.target.value);
            } else {
                document.getElementById('agentDetails').innerHTML = 
                    '<div class="alert alert-info">Select an agent to see details</div>';
                document.getElementById('estimatedCost').textContent = '-';
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadAgents();
            loadCredits();
        });
    </script>
</body>
</html> 